# Lab Assignment 2: Extended Kalman Filtering

The goal of this project was to utilize the Kalman Filter (KF) to estimate the state of our two-wheeled robot. This project was a continuation of Lab Assignment 1: State Estimation. Thus, we used our mathematical model from lab 1 to derive a KF-based state estimation algorithm. 
 
## Code 

This is where all the code we use to run our experiments live.  It is split into two as we had to separate our experiments into two parts.  The first part was running the robot through different scenarios and collecting the time series data of the input commands (which are the PWM values that driven each of the wheels) and the sensor outputs (laser sensors and gyroscope).  The time series data was collected in text files that would then be used by our simulation to estimate states.  The simluation is Python Code that implements a EKF.  The Python code has a state object which is contiuously updated with new state estimates as each line of the input/measurement data from the text file is read in.  

### Paperbot

The code to run the robot and create the actuation and sensor models can be found here.  This is the Arduino code based on on the paper bot skeleton given by Professor Mehta.  It also inclues the ability to read from the sensors, which was given also by Professor Mehta in the test sensor code.  However, we changed from using the magnetometer to a gyroscope from lab 1 in order to get a better theta dot and theta.

The paperbot runs through setup to check if it is still interacing with all the sensors correctly.  Then it begins a loop where it waits for commands from over wifi.  For us we changed this main loop to run the testing for the gyroscope.  The car will spin at various different PWM speeds, which we recorded and placed in the data folder in this repo.  It also outputs the angular velocity of the gyro so we create a noise model for this sensor. 

The other things we run in the main loop is movement functions where the robot will drive forward in a straight path until it reaches close to a wall; and also where it will do this and then turn right.  

### Simulation 

This is where the Python code created on Google collab in order to run our EKF lives.  The algorithm for our EKF and the mathematical equations we use for it are within our lab report, but a short summary is that there are functions to create each of the matrices needed: F, G, and H.  There are two main math functions: a kalman filter function which estimates the next state, and a kalman gain function which uses the measurement input to create the gain that the filter uses for its estimate. 

There are two maiin looping functions that go through the text file of the car's inputs/measurements.  The first is one with a given intial state that is hard coded in.  The other is one without an intial state.  Both of these functions use a state object, and update the state values within the object for each line of inputs/measurements.  

## data 

This folder stores the additional data used in the lab report.  This includes images and videos from our testing, as well as the text files generated by the paperbot code and used in the python EKF folder. 

### Gyro Testing Videos 

We had to additional test the gyroscope because we changed from using the magnetometer to the gyroscope from Lab 1.  In here is the videos of the car spinning at different PWM values.  We measured using the videos the observed angular velocity and compared it to the angular velocity that the gyroscope gave us.  The results of this is graphed in the lab report, but in short car's range of angular velocities due to PWM limitations (from saturation and deadzones) is [-0.2, 0.2], and the values tend to be fairly accurate to what is observed.

### Simulation Tests 

These are the text files that hold the car's inputs/measurements across different scenario runs.  There is a time difference between each of the lines of measurement of dt = 10 ms due to the usage of the delay function in the paperbot Arduino code.  The format of the text files is as follows: 

front laser sensor, right laser sensor, gyroscope angular velocity around z axis, angle of rotation, PWM of left servo, PWM of right servo 

### images 

These images are some of the ones used in our lab report to illustrate some points, as well as additional ones acquired during experiments.  There are model diagrams which include descriptions of the system model, the dynamics model, the measurement model, the KF model, and more.  There are also robot photos of our paperbot that showcase the environment it lives in as well as the images of when we were testing its gyroscope. 
